@model DashboardViewModel
@{
    ViewData["Title"] = "Dashboard";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="fas fa-tachometer-alt text-primary"></i> Dashboard de Usuario</h1>
    <span class="badge bg-success fs-6">
        <i class="fas fa-shield-alt"></i> Sesión Segura
    </span>
</div>

<div class="security-info">
    <h5><i class="fas fa-info-circle"></i> Información de Seguridad</h5>
    <p class="mb-0">Esta página está protegida y requiere autenticación. Los claims han sido enriquecidos automáticamente por el Claims Transformation Service.</p>
</div>

<div class="row">
    <!-- Información del Usuario -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5><i class="fas fa-user"></i> Información del Usuario</h5>
            </div>
            <div class="card-body">
                <table class="table table-borderless">
                    <tr>
                        <td><strong>ID de Usuario:</strong></td>
                        <td><code>@Model.UserId</code></td>
                    </tr>
                    <tr>
                        <td><strong>Email:</strong></td>
                        <td>@Model.Email</td>
                    </tr>
                    <tr>
                        <td><strong>Departamento:</strong></td>
                        <td>
                            <span class="badge bg-info">@Model.Department</span>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Store ID:</strong></td>
                        <td><code>@Model.StoreId</code></td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <!-- Roles Asignados -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5><i class="fas fa-users-cog"></i> Roles Asignados</h5>
            </div>
            <div class="card-body">
                @if (Model.Roles.Any())
                {
                    @foreach (var role in Model.Roles)
                    {
                        <span class="badge bg-success claim-badge">
                            <i class="fas fa-user-tag"></i> @role
                        </span>
                    }
                }
                else
                {
                    <p class="text-muted"><i class="fas fa-exclamation-triangle"></i> No hay roles asignados</p>
                }
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <!-- Permisos Específicos -->
    <div class="col-md-12">
        <div class="card">
            <div class="card-header bg-warning text-dark">
                <h5><i class="fas fa-key"></i> Permisos Específicos</h5>
            </div>
            <div class="card-body">
                @if (Model.Permissions.Any())
                {
                    @foreach (var permission in Model.Permissions)
                    {
                        <span class="badge bg-warning text-dark claim-badge">
                            <i class="fas fa-lock"></i> @permission
                        </span>
                    }
                }
                else
                {
                    <p class="text-muted"><i class="fas fa-info-circle"></i> No hay permisos específicos asignados</p>
                }
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <!-- Acciones Disponibles -->
    <div class="col-md-12">
        <div class="card">
            <div class="card-header bg-dark text-white">
                <h5><i class="fas fa-tasks"></i> Acciones Disponibles Según Autorización</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <h6><i class="fas fa-check-circle text-success"></i> Siempre Disponible</h6>
                        <ul class="list-unstyled">
                            <li><a asp-action="EditProfile" class="btn btn-sm btn-outline-info">
                                <i class="fas fa-user-edit"></i> Editar Perfil
                            </a></li>
                            <li class="mt-2"><a asp-action="Privacy" class="btn btn-sm btn-outline-secondary">
                                <i class="fas fa-shield-alt"></i> Privacidad
                            </a></li>
                        </ul>
                    </div>
                    
                    @if (User.IsInRole("Manager") || User.IsInRole("Admin"))
                    {
                        <div class="col-md-4">
                            <h6><i class="fas fa-star text-warning"></i> Nivel Manager+</h6>
                            <ul class="list-unstyled">
                                <li><a asp-action="ManageProducts" class="btn btn-sm btn-outline-warning">
                                    <i class="fas fa-box"></i> Gestionar Productos
                                </a></li>
                                <li class="mt-2"><a asp-action="Reports" class="btn btn-sm btn-outline-success">
                                    <i class="fas fa-chart-bar"></i> Ver Reportes
                                </a></li>
                                <li class="mt-2"><a asp-action="ApproveDiscounts" class="btn btn-sm btn-outline-info">
                                    <i class="fas fa-percentage"></i> Aprobar Descuentos
                                </a></li>
                            </ul>
                        </div>
                    }
                    
                    @if (User.IsInRole("Admin"))
                    {
                        <div class="col-md-4">
                            <h6><i class="fas fa-crown text-danger"></i> Solo Administradores</h6>
                            <ul class="list-unstyled">
                                <li><a asp-action="AdminPanel" class="btn btn-sm btn-outline-danger">
                                    <i class="fas fa-user-shield"></i> Panel de Admin
                                </a></li>
                            </ul>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Mostrar información adicional sobre los claims
        console.log('Dashboard cargado para usuario: @Model.Email');
        console.log('Roles:', @Html.Raw(Json.Serialize(Model.Roles)));
        console.log('Permisos:', @Html.Raw(Json.Serialize(Model.Permissions)));
    </script>
}