# Prompt Técnico Completo para Cursor: Sistema Bancario SecureBank Digital

## Contexto del Proyecto

Desarrolla una aplicación bancaria completa llamada **SecureBank Digital** - un banco 100% digital fundado en 2018 en Perú que se especializa en servicios financieros con los más altos estándares de seguridad cibernética. La filosofía del banco es "Security First, Innovation Always".

## Especificaciones Técnicas Obligatorias

### Stack Tecnológico Base
- **Framework:** ASP.NET Core 9.0 con arquitectura MVC + Web API
- **Lenguaje:** C# 12 con nullable reference types habilitado
- **Base de Datos:** SQL Server con Entity Framework Core 9
- **Autenticación:** JWT + OAuth 2.0 + OpenID Connect (simular Azure AD B2C)
- **Gestión de Secretos:** Simular Azure Key Vault con configuración segura
- **Logging:** Serilog con structured logging
- **Validation:** FluentValidation para todas las entradas
- **Mapping:** AutoMapper para DTOs
- **Mediator Pattern:** MediatR para CQRS
- **Testing:** xUnit con cobertura de security tests

### Arquitectura Obligatoria
Implementa Clean Architecture con las siguientes capas:
- **Domain:** Entidades, value objects, enums, interfaces del dominio
- **Application:** Commands, queries, handlers, servicios de aplicación, DTOs
- **Infrastructure:** Data access, servicios externos, implementaciones concretas
- **Web:** Controllers, views, models, middleware personalizado

## Funcionalidades Core a Implementar

### 1. SISTEMA DE AUTENTICACIÓN Y AUTORIZACIÓN AVANZADA

#### Proceso de Registro Seguro:
1. **Validación de identidad multi-paso:**
   - Formulario con validación en tiempo real (email, teléfono, documento)
   - Verificación de email con token temporal encriptado
   - Verificación de SMS con código de 6 dígitos
   - Validación de documento de identidad (simulada con OCR mock)
   - Selfie con documento para verificación biométrica (simulada)

2. **Configuración de seguridad inicial:**
   - Creación de PIN de 6 dígitos con políticas robustas
   - Configuración obligatoria de pregunta de seguridad
   - Setup de autenticación de dos factores (TOTP o SMS)
   - Registro de dispositivo confiable con fingerprinting
   - Aceptación de términos y condiciones con timestamp y IP

#### Proceso de Login Multi-Factor:
1. **Primera fase - Credenciales básicas:**
   - Email/documento + PIN con hash BCrypt
   - Validación de dispositivo (nuevo vs confiable)
   - Rate limiting: 3 intentos por minuto, bloqueo temporal tras 5 fallos
   - CAPTCHA después de 2 intentos fallidos

2. **Segunda fase - Autenticación adicional:**
   - Si dispositivo nuevo: SMS + pregunta de seguridad
   - Si dispositivo confiable: Solo TOTP o SMS
   - Para operaciones críticas: Biometric simulation (huella/facial)
   - Validación geográfica (bloquear si país diferente sin autorización)

#### Sistema de Roles y Permisos:
- **Cliente Regular:** Consultas, transferencias hasta $1,000, pagos básicos
- **Cliente Premium:** Límites elevados, productos de inversión, asesoría
- **Cliente Empresarial:** Múltiples usuarios, aprobaciones jerárquicas, reportes
- **Operador de Soporte:** Solo lectura de cuentas, no acceso a transacciones
- **Gerente:** Aprobación de transacciones sospechosas, gestión de límites
- **Auditor de Seguridad:** Acceso completo a logs, métricas de seguridad
- **Administrador:** Gestión completa del sistema

### 2. GESTIÓN INTEGRAL DE CUENTAS BANCARIAS

#### Tipos de Cuenta con Características Específicas:
1. **Cuenta de Ahorros:**
   - Tasa de interés: 2.5% anual, cálculo diario
   - Límite transferencias: $2,000 diarios, $20,000 mensuales
   - Sin comisión de mantenimiento
   - Retiros gratuitos: 4 por mes, después $2 por retiro

2. **Cuenta Corriente:**
   - Sin intereses, sobregiro hasta $500
   - Límite transferencias: $5,000 diarios, $50,000 mensuales
   - Comisión mantenimiento: $8 mensuales
   - Chequera digital incluida

3. **Cuenta Premium:**
   - Tasa preferencial: 3.2% anual
   - Límites elevados: $10,000 diarios, $100,000 mensuales
   - Sin comisiones por servicios
   - Acceso a productos de inversión exclusivos

4. **Cuenta Empresarial:**
   - Multi-usuario con niveles de aprobación
   - Límites configurables por empresa
   - Reportería avanzada y API access
   - Integración con sistemas contables

#### Funcionalidades de Gestión:
- **Consulta de saldos en tiempo real** con encriptación en tránsito
- **Historial transaccional** con filtros: fecha, tipo, monto, estado
- **Estados de cuenta** generados en PDF con firma digital
- **Alertas configurables** por email/SMS para movimientos
- **Bloqueo temporal** de cuenta por parte del usuario
- **Configuración de límites** personalizados dentro de rangos permitidos

### 3. SISTEMA DE TRANSFERENCIAS CON VALIDACIÓN MULTI-CAPA

#### Tipos de Transferencia:
1. **Transferencias Internas** (mismo banco):
   - Validación: Solo PIN + device verification
   - Tiempo de procesamiento: Inmediato
   - Comisión: Gratuito
   - Límite: Según tipo de cuenta

2. **Transferencias Interbancarias** (otros bancos):
   - Validación: PIN + MFA obligatorio para montos > $500
   - Tiempo de procesamiento: 1-24 horas según destino
   - Comisión: $3 para cuentas regulares, gratuito premium
   - Verificación de cuenta destino con nombre del titular

3. **Transferencias Programadas/Recurrentes:**
   - Configuración de fechas y montos fijos
   - Pre-autorización con MFA para toda la serie
   - Cancelación permitida hasta 1 hora antes
   - Notificaciones 24h antes de ejecución

4. **Transferencias Express** (inmediatas):
   - Comisión adicional: $5
   - Disponible 24/7 incluso fines de semana
   - Límite máximo: $5,000 por operación
   - Requiere biometric authentication

#### Proceso de Validación de Transferencias:
1. **Validación inicial:**
   - Verificar saldo suficiente + comisiones
   - Validar límites diarios/mensuales del usuario
   - Verificar estado de cuenta (no bloqueada)
   - Validar formato de cuenta destino

2. **Scoring de riesgo automático:**
   - Análisis de patrón: horario, monto, frecuencia
   - Verificación de lista negra de cuentas
   - Geolocalización: bloquear si IP sospechosa
   - Historial del beneficiario: nuevo vs conocido

3. **Validaciones adicionales por monto:**
   - $0-500: Solo PIN
   - $501-2000: PIN + SMS
   - $2001-5000: PIN + TOTP + pregunta seguridad
   - >$5000: PIN + biometric + aprobación telefónica

4. **Post-validación y ejecución:**
   - Bloqueo temporal de fondos
   - Audit log completo con IP, device, timestamp
   - Ejecución atómica con rollback en caso de error
   - Notificación inmediata a ambas partes

### 4. SISTEMA DE PAGOS Y SERVICIOS INTEGRADO

#### Categorías de Pagos Disponibles:
1. **Servicios Básicos:**
   - Luz, agua, gas, teléfono, internet, cable
   - Validación automática de códigos de cliente
   - Programación de pagos recurrentes
   - Descuentos por pago anticipado

2. **Impuestos y Tributos:**
   - SUNAT: renta, IGV, tributos municipales
   - Validación de RUC/DNI automática
   - Generación de constancias de pago
   - Integración con cronograma de vencimientos

3. **Seguros y Pensiones:**
   - Seguros vehiculares, vida, hogar
   - AFP y sistemas previsionales
   - Validación de pólizas activas
   - Cálculo automático de primas

4. **Educación y Entretenimiento:**
   - Colegios, universidades, institutos
   - Plataformas streaming, gaming, apps
   - Validación de códigos estudiantiles
   - Descuentos por volumen familiar

#### Proceso de Pago Seguro:
1. **Selección y validación:**
   - Búsqueda de empresa por nombre o código
   - Validación de código de cliente en tiempo real
   - Muestra de monto exacto y fecha de vencimiento
   - Cálculo de intereses moratorios si aplica

2. **Confirmación multi-nivel:**
   - Revisión de datos del servicio
   - Selección de cuenta de débito
   - Verificación de saldo disponible
   - Aceptación de términos del pago

3. **Autenticación según monto:**
   - Hasta $100: Solo PIN
   - $101-500: PIN + SMS
   - >$500: PIN + biometric simulation

4. **Procesamiento y confirmación:**
   - Débito inmediato de la cuenta
   - Generación de comprobante digital
   - Envío de notificación a empresa beneficiaria
   - Actualización de historial de pagos

### 5. PRODUCTOS FINANCIEROS CON SIMULADORES

#### Módulo de Créditos y Préstamos:
1. **Evaluación crediticia automática:**
   - Análisis de historial transaccional (6 meses mínimo)
   - Scoring basado en ingresos promedio y regularidad
   - Verificación en centrales de riesgo (simulada)
   - Cálculo de capacidad de pago (30% ingresos máximo)

2. **Tipos de crédito disponibles:**
   - **Personal:** hasta $15,000, 12-60 meses, 15-25% TEA
   - **Vehicular:** hasta $80,000, 12-84 meses, 12-18% TEA
   - **Hipotecario:** hasta $200,000, 120-360 meses, 8-12% TEA
   - **Línea de crédito:** revolving, hasta $5,000, 18-30% TEA

3. **Simulador interactivo:**
   - Cálculo de cuotas con diferentes plazos
   - Comparación de TEA vs TCEA
   - Cronograma de pagos detallado
   - Simulación de pagos anticipados

4. **Proceso de solicitud digital:**
   - Formulario con validación de ingresos
   - Subida de documentos con OCR simulation
   - Evaluación automática en tiempo real
   - Aprobación/rechazo con justificación detallada

#### Módulo de Inversiones:
1. **Depósitos a plazo fijo:**
   - Plazos: 30, 60, 90, 180, 360 días
   - Tasas escalonadas según monto y plazo
   - Simulador de rentabilidad con proyecciones
   - Renovación automática opcional

2. **Fondos mutuos:**
   - Conservador (bonos): 5-8% anual
   - Moderado (mixto): 8-12% anual
   - Agresivo (acciones): 10-18% anual con volatilidad
   - Simulación con datos históricos de mercado

3. **Trading básico:**
   - Compra/venta de acciones principales de BVL
   - Órdenes limitadas y de mercado
   - Portfolio tracking con P&L en tiempo real
   - Alertas de precio y noticias relevantes

### 6. CENTRO DE NOTIFICACIONES Y ALERTAS INTELIGENTES

#### Sistema de Notificaciones Multi-Canal:
1. **Push notifications in-app:**
   - Transacciones completadas/fallidas
   - Alertas de seguridad en tiempo real
   - Recordatorios de pagos próximos a vencer
   - Ofertas personalizadas de productos

2. **Email notifications:**
   - Estados de cuenta mensuales
   - Resúmenes de actividad semanal
   - Alertas de cambios en configuración
   - Confirmaciones de operaciones importantes

3. **SMS alerts:**
   - Transacciones mayores a $200
   - Intentos de login desde dispositivos nuevos
   - Códigos de verificación para MFA
   - Alertas de saldo bajo (configurable)

#### Configuración Personalizable:
- **Umbrales personalizables** para cada tipo de alerta
- **Horarios de silencio** para notificaciones no críticas
- **Canales preferenciales** por tipo de operación
- **Frecuencia de resúmenes** (diario, semanal, mensual)

### 7. PANEL ADMINISTRATIVO CON ANALYTICS AVANZADO

#### Dashboard Operacional:
1. **Métricas en tiempo real:**
   - Transacciones por segundo/minuto/hora
   - Valor total procesado en el día
   - Usuarios activos concurrentes
   - Tiempo de respuesta promedio de APIs

2. **Indicadores de seguridad:**
   - Intentos de login fallidos por hora
   - Transacciones bloqueadas por fraude
   - Alertas de seguridad activas
   - Eventos sospechosos detectados

3. **Gestión de usuarios:**
   - Lista completa con filtros avanzados
   - Histórico de actividad por usuario
   - Bloqueo/desbloqueo de cuentas
   - Reset de credenciales de emergencia

#### Sistema de Detección de Fraude:
1. **Reglas automáticas:**
   - Múltiples transacciones en corto tiempo
   - Transacciones desde ubicaciones geográficas inusuales
   - Montos atípicos basados en historial del usuario
   - Patrones de comportamiento anómalos

2. **Machine Learning simulado:**
   - Scoring de riesgo basado en variables múltiples
   - Detección de anomalías en tiempo real
   - Aprendizaje de patrones normales por usuario
   - Ajuste automático de umbrales de detección

3. **Workflow de investigación:**
   - Cola de casos sospechosos para revisión manual
   - Herramientas de investigación con timeline
   - Capacidad de bloquear/permitir transacciones
   - Documentación de decisiones para auditoría

## Requerimientos de Seguridad Específicos

### 1. Encriptación y Protección de Datos
- **Datos en reposo:** Encriptar con AES-256 todos los campos sensibles (saldos, números de cuenta, PINs)
- **Datos en tránsito:** HTTPS obligatorio con TLS 1.3, certificate pinning simulado
- **PII protection:** Hash irreversible para documentos de identidad, números de teléfono
- **Key rotation:** Simulación de rotación automática de claves cada 90 días

### 2. Audit Trail Inmutable
- **Logging completo:** Toda acción del usuario debe generar log estructurado
- **Retention policy:** Logs de seguridad por 7 años, transaccionales por 10 años
- **Tamper detection:** Hash chains para detectar modificación de logs
- **Real-time alerting:** Alertas automáticas para eventos críticos de seguridad

### 3. Validación y Sanitización Robusta
- **Input validation:** FluentValidation para todos los endpoints con reglas específicas
- **Output encoding:** Prevención de XSS en todas las respuestas HTML
- **SQL injection prevention:** Uso exclusivo de parameterized queries
- **Rate limiting:** Implementar throttling por usuario y por endpoint

### 4. Session Management Seguro
- **JWT con refresh tokens:** Rotación automática cada 15 minutos
- **Session timeout:** 30 minutos de inactividad, logout automático
- **Concurrent sessions:** Máximo 2 sesiones activas por usuario
- **Device binding:** Tokens vinculados a device fingerprint

### 5. Monitoreo y Alertas de Seguridad
- **Real-time monitoring:** Dashboard con métricas de seguridad en vivo
- **Automated responses:** Bloqueo automático ante patrones sospechosos
- **Escalation procedures:** Workflow para incidentes críticos
- **Compliance reporting:** Reportes automáticos para reguladores

## Casos de Uso Críticos para Implementar

### Caso 1: Onboarding Completo de Cliente
1. Registro inicial con validación de identidad en múltiples pasos
2. Configuración de seguridad (MFA, preguntas, dispositivos)
3. Apertura automática de cuenta según perfil
4. Tutorial interactivo de seguridad
5. Primera transacción guiada con validaciones

### Caso 2: Transferencia de Alto Riesgo
1. Cliente intenta transferir $8,000 a cuenta nueva
2. Sistema detecta patrón inusual y aumenta nivel de verificación
3. Requiere biometric + llamada de confirmación
4. Proceso de aprobación manual por gerente
5. Ejecución con monitoreo post-transacción

### Caso 3: Detección y Respuesta a Fraude
1. Múltiples intentos de login desde IPs sospechosas
2. Sistema bloquea cuenta automáticamente
3. Notificación inmediata al cliente por múltiples canales
4. Proceso de verificación de identidad para desbloqueo
5. Investigación forense del incidente

### Caso 4: Renovación de Producto Financiero
1. Cliente con depósito a plazo próximo a vencer
2. Sistema envía alertas y opciones de renovación
3. Simulador de nuevas condiciones de mercado
4. Proceso de renovación con firma digital
5. Confirmación y actualización automática

## Criterios Técnicos de Implementación

### Performance Requirements
- **Response time:** APIs deben responder en menos de 200ms (95th percentile)
- **Throughput:** Mínimo 1000 transacciones por minuto
- **Availability:** 99.9% uptime con circuit breakers para degradación elegante
- **Scalability:** Arquitectura preparada para crecimiento horizontal

### Security Standards
- **OWASP Top 10:** Mitigación completa de todas las vulnerabilidades
- **PCI DSS compliance:** Simulación de requerimientos para manejo de datos de tarjetas
- **SOX compliance:** Controles internos y segregación de funciones
- **Data Privacy:** Implementación de principios GDPR para protección de datos

### Code Quality
- **Test coverage:** Mínimo 80% para lógica de negocio, 95% para funciones de seguridad
- **Documentation:** Comentarios completos y documentación de API con OpenAPI
- **Error handling:** Manejo elegante de errores sin exposición de información sensible
- **Logging:** Structured logging con correlation IDs para trazabilidad

## Entregables Específicos

1. **Aplicación web completamente funcional** con todas las operaciones implementadas
2. **Base de datos** con seed data realista para demostrar todas las funcionalidades
3. **Documentación técnica** completa incluyendo diagramas de arquitectura
4. **Suite de pruebas** que demuestre el funcionamiento de todos los aspectos de seguridad
5. **Scripts de deployment** para configuración automática del entorno

Implementa cada funcionalidad con el máximo nivel de detalle y realismo, asegurando que cada aspecto de seguridad esté correctamente implementado y sea demostrable durante una presentación en vivo.

Base de datos autilizar = PostgreSQL
que las tablas se creen directamente con el codigo y no con el script de creación de la base de datos
solo debes de indicar la base de datos a utilizar en el archivo de configuracion de la aplicacion nada mas
la cadena de conexion debe de ser la siguiente:
Server=localhost;Database=SecureBankDigital;User Id=postgres;Password=123456; y debe estar en el key vault, y debes de recuperarla para hacerl aconxión

todo dato sensible debe estar almacenado en el key vault, y debes de recuperarla para hacerl aconxión
y los keyvault debes de crearlos en el azure portal, y al momento de iniciar la aplicacion, en caso de no existir, debes de crearlos






